<div>
	<h2>UCM - Umbraco Content Merger tool</h2>

	<form name="treeSelector">
		<p>Please select the items you would like to export:</p>
		<div id="tree-view">
		</div>
	</form>
</div>

<script>
	function makeRequest(action, data, callback){
		var url = '/Umbraco/backoffice/Api/UCM/' + action;
		$.post({
			url: url,
			dataType: 'json',
			data: data
		})
		.fail(function(){
			alert('request failed for url: ' + url);
		})
		.done(callback);
	}

	(function(){
	    //get all the content tree
	    makeRequest('GetContentTree', null, function (data) {
            function drawItem(item, level){
				var levelString = '';
				for(var i = 0; i < level; i++){
					levelString += ' - ';
				}

				$('#tree-view').append(levelString+'<label><input type="checkbox" name="'+item.Name+'" value="" item-id="'+item.Id+'"> '+item.Name+'</label><br/>');

				for(var i = 0; i < item.Children.length; i++){
					drawItem(item.Children[i], level + 1);
				}
			}
			
			for(var i = 0; i < data.length; i++){
				drawItem(data[i], 0);
			}

			console.log(data);
	    });
	})();
</script>
